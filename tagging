import pandas as pd
import re

# Example DataFrame
data = {
    "subject": [
        "COB - sales report ending with summary",
        "Meeting notes for project",
        "COB - finance update ending with draft",
        "Reminder: submit timesheet",
        "COB - hr policy ending with approval",
        "Meeting follow-up for client"
    ]
}
df = pd.DataFrame(data)

# Add a new column for tags (starts empty)
df["tag"] = None  

def progress():
    tagged = df["tag"].notna().sum()
    total = len(df)
    print(f"‚úÖ Tagged: {tagged} | ‚è≥ Left: {total - tagged} | Total: {total}")

def preview_matches(pattern):
    """Show which subjects match the regex from untagged rows"""
    try:
        matches = df[df["tag"].isna() & df["subject"].str.contains(pattern, flags=re.IGNORECASE, regex=True)]
        print(matches)
    except re.error as e:
        print(f"‚ùå Invalid regex: {e}")

def apply_tag(pattern, tag):
    """Apply a tag to matched rows and update df"""
    mask = df["tag"].isna() & df["subject"].str.contains(pattern, flags=re.IGNORECASE, regex=True)
    df.loc[mask, "tag"] = tag
    print(f"‚úÖ Applied tag '{tag}' to {mask.sum()} rows.")
    progress()

# -------------------------
# Example usage:
progress()  # Step 1: see progress

preview_matches(r"COB -.*summary")  # Step 2: preview matches

apply_tag(r"COB -.*summary", "Sales")  # Step 3: confirm & apply tag

print("\nüìå Updated DataFrame:")
print(df)
